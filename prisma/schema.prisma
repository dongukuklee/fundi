generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model Auth {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String   @unique
  name      String?
  password  String   
  pincode   String? 
  user      User?
  IDVerification IDVerification?
  withdrawalAccount withdrawalAccount?
}

model IDVerification {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  phoneNumber String?
  auth         Auth          @relation(fields: [authId], references: [id])
  authId       Int           @unique
}
model withdrawalAccount {
   id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  bankCode Int
  accountNumber String
  auth         Auth          @relation(fields: [authId], references: [id])
  authId       Int           @unique
}

model User {
  id           Int           @id @default(autoincrement())
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  email        String        @unique
  name         String?
  role         Role          @default(INVESTOR)
  auth         Auth          @relation(fields: [authId], references: [id])
  authId       Int           @unique
  likeFundings  FundingOnUser[]
  likeArtists   ArtistOnUser[]
  accountCash  AccountCash?
  accountsBond AccountBond[]
}

enum Role {
  ADMIN
  MANAGER
  INVESTOR
}

model AccountCash {
  id           Int               @id @default(autoincrement())
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  owner        User              @relation(fields: [ownerId], references: [id])
  ownerId      Int               @unique
  balance      BigInt            @default(0)
  transactions TransactionCash[]
}

model TransactionCash {
  id        Int             @id @default(autoincrement())
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  title     String
  account   AccountCash     @relation(fields: [accountId], references: [id])
  accountId Int
  amount    BigInt
  accumulatedCash BigInt   @default(0)
  type      TransactionType
}

enum TransactionType {
  DEPOSIT
  WITHDRAW
}

model AccountBond {
  id           Int               @id @default(autoincrement())
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  owner        User              @relation(fields: [ownerId], references: [id])
  ownerId      Int
  balance      BigInt            @default(0)
  transactions TransactionBond[]
  settlementTransactions TransactionSettlement[]
  funding      Funding?          @relation(fields: [fundingId], references: [id])
  fundingId    Int
}

model TransactionBond {
  id        Int             @id @default(autoincrement())
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  title     String
  account   AccountBond     @relation(fields: [accountId], references: [id])
  accountId Int
  amount    BigInt
  type      TransactionType
}

model Funding {
  id               Int           @id @default(autoincrement())
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  status           FundingStatus @default(PRE_CAMPAIGN)
  title            String
  intro            String        @default("")
  artist           ArtistsOnFundings[]
  likedUser        FundingOnUser[]
  contract         Contract?
  bondPrice        BigInt        @default(10000)
  bondsTotalNumber BigInt        @default(10000)
  accountsBond     AccountBond[]
  artworks         Artwork[]  
}


enum FundingStatus {
  PRE_CAMPAIGN
  CAMPAIGNING
  POST_CAMPAIGN
  END
}

model Artist {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  name      String
  description String @default("")
  age       Int?
  biography String   @default("")
  artistInvestmentPoint ArtistInvestmentPoint[]
  fundings  ArtistsOnFundings[]
  likedUser ArtistOnUser[]
}

model ArtistInvestmentPoint {
  id               Int           @id @default(autoincrement())
  createdAt        DateTime      @default(now())
  updatedAt        DateTime     @updatedAt
  title            String
  status           String
  artist           Artist     @relation(fields: [artistId], references: [id])
  artistId         Int
}


model Post {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  title String
  content String
}

model Contract {
  id                     Int      @id @default(autoincrement())
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  funding                Funding? @relation(fields: [fundingId], references: [id])
  fundingId              Int      @unique 
  pricePerSize           Int
  contractedArtworkSize  Int
  terms                  Int      @default(12)
  artworksRequiredNumber Int      @default(12)
}

model Artwork {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  title        String
  funding      Funding? @relation(fields: [fundingId], references: [id])
  fundingId    Int?
  initialPrice BigInt   @default(0)
  sellingPrice BigInt   @default(0)
  isSold       Boolean  @default(false)
}

model TransactionSettlement{
  id                         Int      @id @default(autoincrement())
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  account                    AccountBond     @relation(fields: [accountId], references: [id])
  accountId                  Int
  round                      Int
  settlementAmount           BigInt
  additionalSettleMentAmount BigInt  
}

model ArtistsOnFundings{  
  funding Funding @relation(fields: [fundingId], references: [id])
  fundingId Int 
  artist Artist @relation(fields: [artistId],references: [id])
  artistId Int 
  @@id([artistId,fundingId])
}



model ArtistOnUser{  
  artist Artist @relation(fields: [artistId],references: [id])
  artistId Int 
  User User @relation(fields: [UserId],references: [id])
  UserId Int 
  @@id([artistId,UserId])
}
 

model FundingOnUser{
  funding Funding @relation(fields: [fundingId], references: [id])
  fundingId Int 
  User User @relation(fields: [UserId],references: [id])
  UserId Int 
  @@id([fundingId,UserId])
}