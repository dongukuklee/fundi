generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model Auth {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String   @unique
  name      String?
  pincode   String? 
  user      User?
  IDVerification IDVerification?
  withdrawalAccount withdrawalAccount?
}

model IDVerification {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  phoneNumber String?
  auth         Auth          @relation(fields: [authId], references: [id])
  authId       Int           @unique
}
model withdrawalAccount {
   id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  bankCode Int
  accountNumber String
  auth         Auth          @relation(fields: [authId], references: [id])
  authId       Int           @unique
}

model User {
  id           Int           @id @default(autoincrement())
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  email        String        @unique
  name         String?
  role         Role          @default(INVESTOR)
  auth         Auth          @relation(fields: [authId], references: [id])
  authId       Int           @unique
  likeFundings  FundingOnUser[]

  likedCreator  CreatorOnUser[]
  accountCash  AccountCash?
  accountsBond AccountBond[]
  qna              QnA[]
}

enum Role {
  ADMIN
  MANAGER
  INVESTOR
}

model AccountCash {
  id           Int               @id @default(autoincrement())
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  owner        User              @relation(fields: [ownerId], references: [id])
  ownerId      Int               @unique
  balance      BigInt            @default(0)
  transactions TransactionCash[]
}

model TransactionCash {
  id        Int             @id @default(autoincrement())
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  title     String
  account   AccountCash     @relation(fields: [accountId], references: [id])
  accountId Int
  amount    BigInt
  accumulatedCash BigInt   @default(0)
  type      TransactionType
}

enum TransactionType {
  DEPOSIT
  WITHDRAW
}

model AccountBond {
  id           Int               @id @default(autoincrement())
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  owner        User              @relation(fields: [ownerId], references: [id])
  ownerId      Int
  balance      BigInt            @default(0)
  transactions TransactionBond[]
  settlementTransactions TransactionSettlement[]
  funding      Funding?          @relation(fields: [fundingId], references: [id])
  fundingId    Int
}

model TransactionBond {
  id        Int             @id @default(autoincrement())
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  title     String
  account   AccountBond     @relation(fields: [accountId], references: [id])
  accountId Int
  amount    BigInt
  type      TransactionType
}

model Creator{
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  name      String
  channelTitle String @default("")
  channelUrl  String @default("")
  description String @default("")
  age       Int?  
  isVisible Boolean @default(false)
  biography Biography[]
  fundings CreatorOnFundings[]
  contract Contract[]
  likedUser    CreatorOnUser[]
}

model Contract {
  id                     Int      @id @default(autoincrement())
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt  
  lastYearEarning        BigInt
  fundingAmount          BigInt   
  amountRecieved         BigInt
  funding                Funding?
  type                   ContractTypes @default(LOANS)
  terms                  Int      @default(12)
  creator                Creator     @relation(fields: [creatorId], references: [id])
  creatorId              Int
  startDate              DateTime
  endDate                DateTime
}

model Funding {
  id               Int           @id @default(autoincrement())
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  status           FundingStatus @default(PRE_CAMPAIGN)
  title            String
  intro            String?        @default("")      
  contract         Contract      @relation(fields: [contractId], references: [id])
  contractId       Int           @unique
  isVisible        Boolean       @default(false)
  creator CreatorOnFundings[]
  likedUser        FundingOnUser[]  
  startDate        DateTime
  endDate          DateTime
  currentSettlementRound Int     @default(0)
  bondPrice        BigInt        @default(10000)
  bondsTotalNumber BigInt        @default(10000)
  remainingBonds   BigInt        @default(10000)
  accountsBond     AccountBond[]  
}


enum FundingStatus {
  PRE_CAMPAIGN
  CAMPAIGNING
  POST_CAMPAIGN
  EARLY_CLOSING
  FAILED_CAMPAIGN
  END
}



model Biography{
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  year      String
  description String
  creator           Creator     @relation(fields: [creatorId], references: [id])
  creatorId         Int
}


enum ContractTypes {
  OWENERSHIP_TRANSFER
  LOANS
}

model Artwork {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  title        String  
  fundingId    Int?
  initialPrice BigInt   @default(0)
  sellingPrice BigInt   @default(0)
  isSold       Boolean  @default(false)
}

model TransactionSettlement{
  id                         Int      @id @default(autoincrement())
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  account                    AccountBond     @relation(fields: [accountId], references: [id])
  accountId                  Int    
  round                      Int    
  settlementAmount           BigInt  
  additionalSettleMentAmount BigInt  
}



model CreatorOnFundings{  
  creator Creator @relation(fields: [creatorId], references: [id])
  creatorId Int 
  funding Funding @relation(fields: [fundingId], references: [id])
  fundingId Int
  @@id([creatorId,fundingId])
}




 
model CreatorOnUser{  
  creator Creator @relation(fields: [creatorId],references: [id])
  creatorId Int 
  user User @relation(fields: [userId],references: [id])
  userId Int 
  @@id([creatorId,userId])
}
 

model FundingOnUser{
  funding Funding @relation(fields: [fundingId], references: [id])
  fundingId Int 
  user User @relation(fields: [userId],references: [id])
  userId Int 
  @@id([fundingId,userId])
}

model Notice{
  id                         Int      @id @default(autoincrement())
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  isVisible                  Boolean  @default(false)
  title                      String
  content                    String
}

model QnA {
  id                         Int      @id @default(autoincrement())
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  user                       User @relation(fields: [userId],references: [id])
  userId                     Int 
  isVisible                  Boolean @default(true)
  type                       QnATypes @default(INVESTMENT)
  status                     QnAStatus @default(AWAITING_RESPONSE)
  title                      String
  content                    String
  reply                      String?
}

enum QnATypes {
  INVESTMENT
  ETC
  SETTLEMENT
}

enum QnAStatus {
  AWAITING_RESPONSE
  RESPONDED  
}