generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model Auth {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String   @unique
  name      String
  password  String
  user      User?
}

model User {
  id           Int           @id @default(autoincrement())
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  email        String        @unique
  name         String
  role         Role          @default(INVESTOR)
  auth         Auth          @relation(fields: [authId], references: [id])
  authId       Int           @unique
  accountCash  AccountCash?
  accountsBond AccountBond[]
}

enum Role {
  ADMIN
  MANAGER
  INVESTOR
}

model AccountCash {
  id               Int               @id @default(autoincrement())
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  owner            User              @relation(fields: [ownerId], references: [id])
  ownerId          Int               @unique
  balance          BigInt            @default(0)
  transactionsSent TransactionCash[] @relation(name: "TransactionCashSender")
  transactionsRcvd TransactionCash[] @relation(name: "TransactionCashReceiver")
}

model TransactionCash {
  id         Int                 @id @default(autoincrement())
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  title      String
  sender     AccountCash         @relation(name: "TransactionCashSender", fields: [senderId], references: [id])
  senderId   Int
  receiver   AccountCash         @relation(name: "TransactionCashReceiver", fields: [receiverId], references: [id])
  receiverId Int
  amount     BigInt
  type       TransactionCashType @default(TRANSFER)
}

enum TransactionCashType {
  TRANSFER
  RETURN
}

model AccountBond {
  id               Int               @id @default(autoincrement())
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  owner            User              @relation(fields: [ownerId], references: [id])
  ownerId          Int               @unique
  balance          BigInt            @default(0)
  transactionsSent TransactionBond[] @relation(name: "TransactionBondSender")
  transactionsRcvd TransactionBond[] @relation(name: "TransactionBondReceiver")
  funding          Funding?          @relation(fields: [fundingId], references: [id])
  fundingId        Int
}

model TransactionBond {
  id         Int         @id @default(autoincrement())
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  title      String
  sender     AccountBond @relation(name: "TransactionBondSender", fields: [senderId], references: [id])
  senderId   Int
  receiver   AccountBond @relation(name: "TransactionBondReceiver", fields: [receiverId], references: [id])
  receiverId Int
  amount     BigInt
}

model Funding {
  id              Int           @id @default(autoincrement())
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  title           String
  artist          Artist?       @relation(fields: [artistId], references: [id])
  artistId        Int
  contract        Contract?
  bondPrice       BigInt        @default(10000)
  bondTotalNumber BigInt        @default(10000)
  status          FundingStatus @default(PRE_CAMPAIGN)
  accountsBond    AccountBond[]
  artworks        Artwork[]
}

enum FundingStatus {
  PRE_CAMPAIGN
  CAMPAIGNING
  POST_CAMPAIGN
  END
}

model Artist {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  name      String
  age       Int?
  fundings  Funding[]
}

model Contract {
  id                     Int      @id @default(autoincrement())
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  funding                Funding? @relation(fields: [fundingId], references: [id])
  fundingId              Int      @unique
  price                  BigInt   @default(100000000)
  terms                  Int      @default(12)
  artworksRequiredNumber Int      @default(12)
}

model Artwork {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  title        String
  funding      Funding? @relation(fields: [fundingId], references: [id])
  fundingId    Int
  initialPrice BigInt   @default(0)
  sellingPrice BigInt   @default(0)
  isSold       Boolean  @default(false)
}
